<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arcade</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/ArisEdu Project Folder/styles/main.css">
  <style>
    .arcade-container {
      background: #f8fafc;
      border: 2px solid rgba(226, 232, 240, 0.8);
      border-radius: 2rem;
      padding: 2.5rem;
      margin-bottom: 2rem;
    }

    body.dark-mode .arcade-container {
      background: #273244;
      border: 2px solid rgba(226, 232, 240, 0.22);
    }

    .arcade-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
    }

    @media (max-width: 768px) {
      .arcade-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .arcade-grid {
        grid-template-columns: 1fr;
      }
    }

    .game-card {
      background: #ffffff;
      border: 2px solid #e2e8f0;
      border-radius: 1.25rem;
      padding: 2rem 1.5rem;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      text-decoration: none;
      position: relative;
      overflow: hidden;
    }

    .game-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      border-radius: 1.25rem 1.25rem 0 0;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .game-card:hover::before {
      opacity: 1;
    }

    .game-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
      border-color: transparent;
    }

    body.dark-mode .game-card {
      background: #1e293b;
      border-color: #334155;
    }

    body.dark-mode .game-card:hover {
      background: #1e293b;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
    }

    .game-icon {
      width: 80px;
      height: 80px;
      border-radius: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      flex-shrink: 0;
    }

    .game-title {
      font-family: 'Orbitron', 'Poppins', sans-serif;
      font-size: 1.05rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .game-desc {
      font-size: 0.85rem;
      color: #64748b;
      line-height: 1.4;
    }

    body.dark-mode .game-desc {
      color: #94a3b8;
    }

    /* Snake - green */
    .game-card.snake::before { background: linear-gradient(90deg, #22c55e, #16a34a); }
    .game-card.snake .game-icon { background: rgba(34, 197, 94, 0.15); }
    .game-card.snake .game-title { color: #22c55e; }

    /* Pac-Man - yellow */
    .game-card.pacman::before { background: linear-gradient(90deg, #facc15, #eab308); }
    .game-card.pacman .game-icon { background: rgba(250, 204, 21, 0.15); }
    .game-card.pacman .game-title { color: #eab308; }

    /* Platformer - blue */
    .game-card.platformer::before { background: linear-gradient(90deg, #3b82f6, #2563eb); }
    .game-card.platformer .game-icon { background: rgba(59, 130, 246, 0.15); }
    .game-card.platformer .game-title { color: #3b82f6; }

    /* Spaceship - purple */
    .game-card.spaceship::before { background: linear-gradient(90deg, #8b5cf6, #7c3aed); }
    .game-card.spaceship .game-icon { background: rgba(139, 92, 246, 0.15); }
    .game-card.spaceship .game-title { color: #8b5cf6; }

    /* Tetris - red/orange */
    .game-card.tetris::before { background: linear-gradient(90deg, #ef4444, #f97316); }
    .game-card.tetris .game-icon { background: rgba(239, 68, 68, 0.15); }
    .game-card.tetris .game-title { color: #ef4444; }

    /* Block Puzzle - teal */
    .game-card.blocks::before { background: linear-gradient(90deg, #14b8a6, #0d9488); }
    .game-card.blocks .game-icon { background: rgba(20, 184, 166, 0.15); }
    .game-card.blocks .game-title { color: #14b8a6; }
  </style>
  <script src="theme_manager.js"></script>
</head>
 <body class="dark-mode h-full">
<script src="scripts/taskbar.js"></script>
  <main class="main-container">
    <div class="logo-title-wrapper" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
      <h1 id="company-name" class="logo-font page-title" style="font-size: 3rem; margin-bottom: 0;">ðŸ‘¾ Arcade</h1>
    </div>

    <div class="arcade-container">
      <div class="arcade-grid">

        <!-- Snake -->
        <a href="GameSnake.html" class="game-card snake">
          <div class="game-icon">
            <svg viewBox="0 0 64 64" width="48" height="48" fill="none">
              <rect x="8" y="28" width="8" height="8" rx="1" fill="#22c55e"/>
              <rect x="16" y="28" width="8" height="8" rx="1" fill="#16a34a"/>
              <rect x="24" y="28" width="8" height="8" rx="1" fill="#22c55e"/>
              <rect x="32" y="28" width="8" height="8" rx="1" fill="#16a34a"/>
              <rect x="32" y="20" width="8" height="8" rx="1" fill="#22c55e"/>
              <rect x="40" y="20" width="8" height="8" rx="1" fill="#16a34a"/>
              <circle cx="46" cy="23" r="1.5" fill="white"/>
              <circle cx="46" cy="23" r="0.8" fill="#0f172a"/>
              <circle cx="52" cy="44" r="4" fill="#ef4444"/>
            </svg>
          </div>
          <span class="game-title">SNAKE</span>
          <span class="game-desc">Eat apples, grow longer, don't hit yourself!</span>
        </a>

        <!-- Pac-Man -->
        <a href="GamePacman.html" class="game-card pacman">
          <div class="game-icon">
            <svg viewBox="0 0 64 64" width="48" height="48" fill="none">
              <path d="M32 8 A24 24 0 1 1 32 56 A24 24 0 0 1 32 8 Z" fill="#facc15"/>
              <path d="M32 32 L56 20 L56 44 Z" fill="#1e293b"/>
              <circle cx="36" cy="22" r="3" fill="#0f172a"/>
              <circle cx="10" cy="32" r="2" fill="#facc15" opacity="0.6"/>
              <circle cx="18" cy="32" r="2" fill="#facc15" opacity="0.6"/>
            </svg>
          </div>
          <span class="game-title">PAC-MAN</span>
          <span class="game-desc">Chomp pellets, dodge ghosts, clear the maze!</span>
        </a>

        <!-- Platformer -->
        <a href="GamePlatformer.html" class="game-card platformer">
          <div class="game-icon">
            <svg viewBox="0 0 64 64" width="48" height="48" fill="none">
              <rect x="4" y="52" width="56" height="8" rx="2" fill="#3b82f6" opacity="0.3"/>
              <rect x="20" y="36" width="24" height="6" rx="2" fill="#3b82f6" opacity="0.5"/>
              <rect x="36" y="20" width="20" height="6" rx="2" fill="#3b82f6" opacity="0.7"/>
              <rect x="8" y="20" width="16" height="6" rx="2" fill="#3b82f6" opacity="0.7"/>
              <rect x="24" y="42" width="8" height="10" rx="1" fill="#3b82f6"/>
              <circle cx="28" cy="38" r="5" fill="#60a5fa"/>
              <circle cx="26" cy="37" r="1" fill="white"/>
              <circle cx="30" cy="37" r="1" fill="white"/>
            </svg>
          </div>
          <span class="game-title">PLATFORMER</span>
          <span class="game-desc">Jump, run, and reach the flag!</span>
        </a>

        <!-- Spaceship Shooter -->
        <a href="GameSpaceship.html" class="game-card spaceship">
          <div class="game-icon">
            <svg viewBox="0 0 64 64" width="48" height="48" fill="none">
              <polygon points="32,4 22,44 32,38 42,44" fill="#8b5cf6"/>
              <polygon points="32,38 22,44 18,52 32,46" fill="#7c3aed"/>
              <polygon points="32,38 42,44 46,52 32,46" fill="#6d28d9"/>
              <rect x="30" y="46" width="4" height="10" rx="1" fill="#f97316"/>
              <rect x="28" y="50" width="8" height="8" rx="1" fill="#fbbf24" opacity="0.6"/>
              <circle cx="20" cy="12" r="1" fill="white" opacity="0.5"/>
              <circle cx="50" cy="24" r="1.5" fill="white" opacity="0.4"/>
              <circle cx="12" cy="36" r="1" fill="white" opacity="0.3"/>
              <circle cx="54" cy="48" r="0.8" fill="white" opacity="0.5"/>
            </svg>
          </div>
          <span class="game-title">SPACE SHOOTER</span>
          <span class="game-desc">Blast enemies, dodge asteroids, survive waves!</span>
        </a>

        <!-- Tetris -->
        <a href="GameTetris.html" class="game-card tetris">
          <div class="game-icon">
            <svg viewBox="0 0 64 64" width="48" height="48" fill="none">
              <rect x="16" y="8" width="10" height="10" rx="1" fill="#ef4444"/>
              <rect x="26" y="8" width="10" height="10" rx="1" fill="#ef4444"/>
              <rect x="26" y="18" width="10" height="10" rx="1" fill="#ef4444"/>
              <rect x="36" y="18" width="10" height="10" rx="1" fill="#ef4444"/>
              <rect x="8" y="44" width="10" height="10" rx="1" fill="#3b82f6"/>
              <rect x="18" y="44" width="10" height="10" rx="1" fill="#3b82f6"/>
              <rect x="28" y="44" width="10" height="10" rx="1" fill="#3b82f6"/>
              <rect x="38" y="44" width="10" height="10" rx="1" fill="#3b82f6"/>
              <rect x="18" y="28" width="10" height="10" rx="1" fill="#22c55e"/>
              <rect x="28" y="28" width="10" height="10" rx="1" fill="#22c55e"/>
              <rect x="28" y="38" width="10" height="10" rx="1" fill="#facc15"/>
              <rect x="38" y="38" width="10" height="10" rx="1" fill="#facc15"/>
              <rect x="38" y="28" width="10" height="10" rx="1" fill="#facc15"/>
            </svg>
          </div>
          <span class="game-title">TETRIS</span>
          <span class="game-desc">Stack blocks, clear lines, beat your high score!</span>
        </a>

        <!-- Block Puzzle -->
        <a href="GameBlocks.html" class="game-card blocks">
          <div class="game-icon">
            <svg viewBox="0 0 64 64" width="48" height="48" fill="none">
              <rect x="8" y="8" width="12" height="12" rx="2" fill="#14b8a6"/>
              <rect x="22" y="8" width="12" height="12" rx="2" fill="#0d9488"/>
              <rect x="8" y="22" width="12" height="12" rx="2" fill="#0d9488"/>
              <rect x="22" y="22" width="12" height="12" rx="2" fill="#14b8a6"/>
              <rect x="36" y="22" width="12" height="12" rx="2" fill="#14b8a6" opacity="0.5"/>
              <rect x="8" y="36" width="12" height="12" rx="2" fill="#14b8a6" opacity="0.5"/>
              <rect x="22" y="36" width="12" height="12" rx="2" fill="#0d9488" opacity="0.5"/>
              <rect x="36" y="36" width="12" height="12" rx="2" fill="#14b8a6" opacity="0.3"/>
              <rect x="36" y="8" width="12" height="12" rx="2" fill="#14b8a6" opacity="0.3"/>
            </svg>
          </div>
          <span class="game-title">BLOCK PUZZLE</span>
          <span class="game-desc">Drag &amp; drop shapes, clear rows and columns!</span>
        </a>

      </div>
    </div>
  </main>
  <script>
    (function() {
      // 1. Theme Logic
      const theme = localStorage.getItem('arisEduColorTheme') || 'blue-green';
      const taskbar = document.querySelector('.taskbar');
      if (taskbar && theme === 'sunset') {
        taskbar.style.background = 'linear-gradient(to right, #FF7E5F, #00C9A7, #1A2A6C)';
      }

      // 2. Arcade Locking Mechanism
      // CSS Injection for Locked State
      const style = document.createElement('style');
      style.textContent = `
        .game-card { position: relative; }
        .game-card.locked {
            filter: grayscale(0.9) contrast(0.8);
            pointer-events: none; /* Disable link navigation */
        }
        .lock-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 1.25rem;
            z-index: 10;
            pointer-events: auto; /* Catch clicks */
            cursor: pointer;
            backdrop-filter: blur(2px);
            transition: background 0.2s;
        }
        .lock-overlay:hover {
            background: rgba(15, 23, 42, 0.7);
        }
        .lock-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .lock-text { color: white; font-weight: 700; font-family: 'Poppins', sans-serif; }
        .lock-price { 
            background: #f59e0b; color: #000; 
            padding: 0.25rem 0.75rem; border-radius: 1rem; 
            font-size: 0.9rem; font-weight: 700; 
            margin-top: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
      `;
      document.head.appendChild(style);

      // Game Costs (Example Economy)
      const gameCosts = {
          'match': 0, // Free
          'snake': 0, // Free
          'platformer': 50,
          'spaceship': 100,
          'tetris': 200,
          'blocks': 300,
          'pacman': 400
      };

      // Ensure all game cards have identifiable classes if not present
      // Current classes: game-card match, game-card snake, etc.
      // Need to handle generic ones just in case.

      // User Data
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      const unlocked = user.unlockedGames || ['match', 'snake']; 
      const currentPoints = user.points || 0; 

      // Apply Locks
      document.querySelectorAll('.game-card').forEach(card => {
          // Identify game from href or class
          let gameId = '';
          if(card.classList.contains('match')) gameId = 'match';
          else if(card.classList.contains('snake')) gameId = 'snake';
          else if(card.classList.contains('platformer') || card.href.includes('Platformer')) gameId = 'platformer';
          else if(card.classList.contains('spaceship') || card.href.includes('Spaceship')) gameId = 'spaceship';
          else if(card.classList.contains('tetris') || card.href.includes('Tetris')) gameId = 'tetris';
          else if(card.classList.contains('blocks') || card.href.includes('Blocks')) gameId = 'blocks';
          else if(card.href.includes('Pacman')) gameId = 'pacman';

          // Default cost if not listed (e.g. new games)
          if(gameId && !(gameId in gameCosts)) gameCosts[gameId] = 500; 

          if(gameId && gameCosts[gameId] > 0 && !unlocked.includes(gameId)) {
              // Lock it
              card.classList.add('locked');
              
              const overlay = document.createElement('div');
              overlay.className = 'lock-overlay';
              overlay.innerHTML = `
                  <div class="lock-icon">ðŸ”’</div>
                  <div class="lock-text">LOCKED</div>
                  <div class="lock-price">${gameCosts[gameId]} Pts</div>
              `;
              
              overlay.onclick = (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  
                  // Custom Modal Logic
                  const modalOverlay = document.createElement('div');
                  modalOverlay.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);z-index:9999;display:flex;justify-content:center;align-items:center;";
                  
                  const modalContent = document.createElement('div');
                  modalContent.style.cssText = "background:white;padding:2rem;border-radius:1rem;width:90%;max-width:400px;text-align:center;box-shadow:0 10px 25px rgba(0,0,0,0.3);animation:popIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);";
                  
                  const canAfford = currentPoints >= gameCosts[gameId];
                  
                  modalContent.innerHTML = `
                      <h2 style="font-size:1.5rem;font-weight:700;margin-bottom:1rem;color:#1e293b;">Unlock ${gameId.charAt(0).toUpperCase() + gameId.slice(1)}?</h2>
                      <div style="font-size:3rem;margin-bottom:1rem;">${canAfford ? 'ðŸ”“' : 'ðŸ”’'}</div>
                      <p style="margin-bottom:1.5rem;color:#64748b;">
                        Cost: <strong style="color:#f59e0b;">${gameCosts[gameId]} Pts</strong><br>
                        You have: <strong>${currentPoints} Pts</strong>
                      </p>
                      <div style="display:flex;gap:1rem;justify-content:center;">
                          <button id="cancel-unlock" style="padding:0.75rem 1.5rem;border-radius:0.5rem;border:1px solid #cbd5e1;background:white;color:#64748b;cursor:pointer;font-weight:600;">Cancel</button>
                          ${canAfford ? 
                            `<button id="confirm-unlock" style="padding:0.75rem 1.5rem;border-radius:0.5rem;border:none;background:#10b981;color:white;cursor:pointer;font-weight:600;box-shadow:0 4px 6px rgba(16,185,129,0.2);">Unlock Now</button>` : 
                            `<button disabled style="padding:0.75rem 1.5rem;border-radius:0.5rem;border:none;background:#e2e8f0;color:#94a3b8;cursor:not-allowed;font-weight:600;">Need More Points</button>`
                          }
                      </div>
                  `;
                  
                  modalOverlay.appendChild(modalContent);
                  document.body.appendChild(modalOverlay);
                  
                  // Animation keyframes if not exists
                  if(!document.getElementById('popInAnim')) {
                      const s = document.createElement('style');
                      s.id = 'popInAnim';
                      s.innerHTML = `@keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }`;
                      document.head.appendChild(s);
                  }

                  // Event Listeners
                  modalContent.querySelector('#cancel-unlock').onclick = () => modalOverlay.remove();
                  
                  const confirmBtn = modalContent.querySelector('#confirm-unlock');
                  if(confirmBtn) {
                      confirmBtn.onclick = async () => {
                          confirmBtn.textContent = "Unlocking...";
                          // Deduct and Unlock
                          user.points = currentPoints - gameCosts[gameId];
                          user.unlockedGames = [...unlocked, gameId];
                          localStorage.setItem('user', JSON.stringify(user));
                          
                          // Sync Firebase
                          try {
                              const { auth, db, doc, updateDoc, arrayUnion, increment } = await import('./firebase-config.js');
                              if(auth.currentUser) {
                                  const userRef = doc(db, "users", auth.currentUser.uid);
                                  await updateDoc(userRef, {
                                      points: increment(-gameCosts[gameId]),
                                      unlockedGames: arrayUnion(gameId)
                                  });
                              }
                          } catch(e) { console.warn("Offline unlock"); }

                          // Visual Update
                          card.classList.remove('locked');
                          overlay.remove();
                          modalOverlay.remove();
                          
                          // Success Toast
                          const toast = document.createElement('div');
                          toast.textContent = "Game Unlocked!";
                          toast.style.cssText = "position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#10b981;color:white;padding:0.75rem 1.5rem;border-radius:2rem;box-shadow:0 10px 15px rgba(0,0,0,0.1);z-index:9999;font-weight:600;";
                          document.body.appendChild(toast);
                          setTimeout(() => toast.remove(), 2500);
                          setTimeout(() => location.reload(), 1000); // Reload to ensure state consistency
                      };
                  }
              };
              
              card.appendChild(overlay);
          }
      });

    })();
  </script>
 </body>
</html>
