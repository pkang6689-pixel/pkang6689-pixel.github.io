<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Preferences</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <script src="theme_manager.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #3b82f6 0%, #10b981 50%, #8b5cf6 100%);
      transition: background 0.3s;
    }
    body.dark-mode {
      background: #0f172a;
    }
    .taskbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #3b82f6 0%, #10b981 50%, #8b5cf6 100%);
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .taskbar.sunset-theme {
      background: linear-gradient(to right, #FF7E5F, #00C9A7, #1A2A6C) !important;
    }
    .settings-container {
      background: transparent;
      transition: background 0.3s;
    }
    body.dark-mode .settings-container {
      background: #1e293b;
    }
    body.aurora-mode .settings-container {
      background: linear-gradient(to right, #23243a, #334155, #1A2A6C);
    }
    body.aurora-mode.dark-mode .settings-container {
      background: linear-gradient(to right, #23243a, #334155, #1A2A6C);
    }
    .taskbar-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem 1rem;
      max-width: 1200px;
      width: 100%;
    }
    .taskbar-button {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 600;
      color: white;
      font-size: 0.875rem;
      transition: opacity 0.3s, transform 0.2s;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .taskbar-button:hover {
      opacity: 0.9;
      scale: 1.05;
      background: rgba(255, 255, 255, 0.2);
    }
    .settings-menu {
      width: 13rem;
      padding: 0.5rem;
      background: #ffffff;
      border-radius: 0.5rem;
      box-shadow: 0 8px 20px rgba(2,6,23,0.12);
      color: #0f172a;
      font-size: 0.95rem;
      visibility: hidden;
      opacity: 0;
      transform: translateY(-6px);
      transition: opacity 0.18s ease, transform 0.18s ease, visibility 0.18s;
      position: absolute;
      top: 100%;
      right: 1rem;
      left: auto;
      bottom: auto;
    }
    body.dark-mode .settings-menu {
      background: #0f172a;
      color: #cbd5e1;
    }
    
    /* Native Select and Input Styles for Preferences */
    .preferences-select,
    .preferences-input {
        margin-left: 0.75rem;
        padding: 0.3rem 0.6rem;
        border-radius: 0.4rem;
        background-color: #fff;
        color: #333;
        border: 1px solid #e2e8f0;
    }
    body.dark-mode .preferences-select,
    body.dark-mode .preferences-input {
        background-color: #273244;
        color: #e2e8f0;
        border-color: #334155;
    }

    /* Custom Select Styles */
    .custom-select-wrapper {
        position: relative;
        user-select: none;
        width: 100%;
        max-width: 300px;
        margin-left: 0.75rem;
    }
    .custom-select {
        position: relative;
        display: flex;
        flex-direction: column;
    }
    .custom-select-trigger {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        font-weight: 500;
        color: #333;
        background: #fff;
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    body.dark-mode .custom-select-trigger {
        background: #273244;
        color: #e2e8f0;
        border-color: #334155;
    }
    .custom-options {
        position: absolute;
        display: block;
        top: 100%;
        left: 0;
        right: 0;
        background: #fff;
        border: 1px solid #e2e8f0;
        border-top: 0;
        border-bottom-left-radius: 0.5rem;
        border-bottom-right-radius: 0.5rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        z-index: 50;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transform: translateY(-10px);
        transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
        margin-top: 0.5rem;
        max-height: 200px;
        overflow-y: auto;
    }
    body.dark-mode .custom-options {
        background: #1e293b;
        border-color: #334155;
    }
    .custom-select.open .custom-options {
        opacity: 1;
        visibility: visible;
        pointer-events: all;
        transform: translateY(0);
    }
    .custom-option {
        position: relative;
        display: block;
        padding: 0.75rem 1rem;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border-bottom: 1px solid #f1f5f9;
        
        /* Gradient Text Base Styles */
        background-clip: text !important;
        -webkit-background-clip: text !important;
        -webkit-text-fill-color: transparent !important;
        color: transparent; 
    }
    body.dark-mode .custom-option {
        border-color: #334155;
    }
    .custom-option:last-of-type {
        border-bottom: 0;
    }
    .custom-option:hover {
        background-color: #f8fafc;
        transform: padding-left 5px;
    }
    body.dark-mode .custom-option:hover {
        background-color: #334155;
    }
    .custom-option.selected {
        background-color: #f1f5f9;
    }
    body.dark-mode .custom-option.selected {
        background-color: #475569;
    }

    /* Fixed Preferences Layout Styles */
    .preferences-layout {
      width: 90vw;
      height: 85vh;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border-radius: 2rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
      font-family: 'Poppins', sans-serif;
      display: flex;
      flex-direction: row;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      transition: background 0.3s, color 0.3s;
    }
    
    body.dark-mode .preferences-layout {
      background: rgba(30, 41, 59, 0.95);
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      color: #e2e8f0;
    }

    .preferences-sidebar {
      width: 18vw;
      min-width: 220px;
      background: #e0e7ef;
      border-radius: 2rem 0 0 2rem;
      padding: 2rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      transition: background 0.3s;
    }

    body.dark-mode .preferences-sidebar {
      background: #0f172a;
    }

    .sidebar-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 2rem;
      text-align: left;
      background: linear-gradient(135deg, #3b82f6 0%, #10b981 50%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      color: transparent;
    }

    .sidebar-categories {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .settings-category {
      background: #fff;
      border: none;
      border-radius: 0.7rem;
      padding: 1rem;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      text-align: left;
      color: #334155;
      transition: all 0.2s;
    }

    /* Selected Gradient Text Style */
    .gradient-text-selected {
        background-clip: text !important;
        -webkit-background-clip: text !important;
        color: transparent !important;
        -webkit-text-fill-color: transparent !important;
        font-weight: 700 !important;
        display: inline-block !important;
    }

    body.dark-mode .settings-category {
      background: #1e293b;
      color: #e2e8f0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }

    .settings-category:hover {
      transform: translateX(4px);
    }
    
    .preferences-panel {
      flex: 1;
      padding: 3rem;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: flex-start;
      color: #1e293b;
    }

    body.dark-mode .preferences-panel {
      color: #e2e8f0;
    }

  </style>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
<nav class="taskbar">
  <div class="taskbar-container">
    <button class="taskbar-button" id="search-button">ğŸ” Search</button>
    <a class="taskbar-button" id="homepage-button" href="../index.html">ğŸ  Homepage</a>
    <a class="taskbar-button" id="course-button" href="Courses.html">ğŸ“š Courses</a>
    <button class="taskbar-button" id="view-bg-button">ğŸ‘ï¸ View BG</button>
    <button class="taskbar-button" id="settings-button">âš™ï¸ Settings</button>
    <a class="taskbar-button" id="login-signup-button" href="LoginSignup.html">ğŸ” Login/Signup</a>
  </div>
  <div class="settings-menu" id="settings-menu" aria-hidden="true">
    <div class="settings-item">
      <label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer;">
        <input type="checkbox" id="dark-mode-checkbox" / checked>
        <span>Dark Mode</span>
      </label>
    </div>
    <a class="settings-item" href="Preferences.html">Preferences</a>
  </div>
</nav>

<div class="preferences-layout">
  <aside class="preferences-sidebar">
    <h2 class="sidebar-title">Settings</h2>
    <div id="sidebar-categories" class="sidebar-categories">
      <button class="settings-category" data-category="appearance">Appearance</button>
      <button class="settings-category" data-category="account">Account</button>
      <button class="settings-category" data-category="notifications">Notifications</button>
    </div>
  </aside>
  <section id="settings-panel" class="preferences-panel">
    <!-- Settings options will be rendered here -->
  </section>
</div>
<script>
    // ...existing code...
// Sidebar and taskbar translations
const sidebarLabels = {
  english: {
    settings: 'Settings',
    appearance: 'Appearance',
    account: 'Account',
    notifications: 'Notifications',
    search: 'ğŸ” Search',
    homepage: 'ğŸ  Homepage',
    courses: 'ğŸ“š Courses',
    play: 'â–¶ï¸ Play',
    settingsBtn: 'âš™ï¸ Settings',
    loginSignup: 'ğŸ” Login/Signup',
    preferences: 'Preferences',
    darkMode: 'Dark Mode',
  },
  chinese: {
    settings: 'è®¾ç½®',
    appearance: 'å¤–è§‚',
    account: 'è´¦æˆ·',
    notifications: 'é€šçŸ¥',
    search: 'ğŸ” æœç´¢',
    homepage: 'ğŸ  é¦–é¡µ',
    courses: 'ğŸ“š è¯¾ç¨‹',
    play: 'â–¶ï¸ ç©',
    settingsBtn: 'âš™ï¸ è®¾ç½®',
    loginSignup: 'ğŸ” ç™»å½•/æ³¨å†Œ',
    preferences: 'åå¥½è®¾ç½®',
    darkMode: 'æ·±è‰²æ¨¡å¼',
  }
};

function updateSidebarLanguage() {
  const lang = localStorage.getItem('arisEduLanguage') || 'english';
  const labels = sidebarLabels[lang];
  document.querySelector('aside h2').textContent = labels.settings;
  const buttons = document.querySelectorAll('.settings-category');
  if (buttons.length === 3) {
    buttons[0].textContent = labels.appearance;
    buttons[1].textContent = labels.account;
    buttons[2].textContent = labels.notifications;
  }
  document.getElementById('search-button').textContent = labels.search;
  document.getElementById('homepage-button').textContent = labels.homepage;
  document.getElementById('course-button').textContent = labels.courses;
  
  document.getElementById('settings-button').textContent = labels.settingsBtn;
  document.getElementById('login-signup-button').textContent = labels.loginSignup;
  // Settings menu
  document.querySelector('#settings-menu .settings-item span').textContent = labels.darkMode;
  document.querySelector('#settings-menu .settings-item + a').textContent = labels.preferences;
}
const settingsOptions = {
  appearance_en: `
    <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem;">Appearance Settings</h2>
    <form id="appearance-form">
      <div style="margin-bottom: 1.5rem;">
        <label style="display: flex; align-items: center; gap: 0.75rem; font-size: 1.1rem;">
          <input type="checkbox" id="darkModeToggle" />
          <span>Enable Dark Mode</span>
        </label>
      </div>
      <div style="margin-bottom: 1.5rem;">
          <label style="font-size: 1.1rem;">Language:
            <select id="languageSelect" class="preferences-select">
              <option value="english">English</option>
              <option value="chinese">ä¸­æ–‡</option>
            </select>
          </label>
      </div>
      <div style="margin-bottom: 1.5rem;">
        <label style="font-size: 1.1rem;">Suggested Color Themes:</label>
        <div class="custom-select-wrapper">
            <div class="custom-select" id="customThemeSelectSuggested">
                <div class="custom-select-trigger">
                    <span>Select Theme</span>
                    <div class="arrow">â–¼</div>
                </div>
                <div class="custom-options">
                    <span class="custom-option" data-value="blue-green" style="background: linear-gradient(135deg, #3b82f6 0%, #10b981 50%, #8b5cf6 100%);">Aurora (Default)</span>
                    <span class="custom-option" data-value="sunset" style="background: linear-gradient(to right, #FF7E5F, #00C9A7, #1A2A6C);">Sunset</span>
                    <span class="custom-option" data-value="coral" style="background: linear-gradient(to right, #FF6F61, #40E0D0, #4B0082);">Coral reef</span>
                    <span class="custom-option" data-value="autumn" style="background: linear-gradient(to right, #CC5500, #DAA520, #8B4513);">Autumn</span>
                    <span class="custom-option" data-value="sunrise" style="background: linear-gradient(to right, #FFDAB9, #FF7F50, #FFFACD);">Sunrise</span>
                    <span class="custom-option" data-value="lavender" style="background: linear-gradient(to right, #C8A2C8, #9DC183, #FFFDD0);">Lavender</span>
                    <span class="custom-option" data-value="cyber" style="background: linear-gradient(to right, #000000, #00FFFF);">Cyber</span>
                </div>
            </div>
        </div>
      </div>
      <div style="margin-bottom: 1.5rem;">
        <label style="font-size: 1.1rem;">Other Color Themes:</label>
        <div class="custom-select-wrapper">
            <div class="custom-select" id="customThemeSelectOther">
                <div class="custom-select-trigger">
                    <span>Select Theme</span>
                    <div class="arrow">â–¼</div>
                </div>
                <div class="custom-options">
                    <span class="custom-option" data-value="aurora-veil" style="background: linear-gradient(to right, #32CD32, #00FFFF, #8A2BE2);">Aurora veil</span>
                    <span class="custom-option" data-value="twilight" style="background: linear-gradient(to right, #50C878, #0F52BA, #FF00FF);">Twilight</span>
                    <span class="custom-option" data-value="forest" style="background: linear-gradient(to right, #228B22, #87CEEB, #E6E6FA);">Forest mist</span>
                    <span class="custom-option" data-value="ocean-mist" style="background: linear-gradient(to right, #001F3F, #3D9970, #E0FFFF);">Ocean Mist</span>
                    <span class="custom-option" data-value="solar" style="background: linear-gradient(to right, #FFD700, #DC143C, #2E0854);">Solar</span>
                    <span class="custom-option" data-value="crimson" style="background: linear-gradient(to right, #FFC0CB, #C21E56, #420D09);">Crimson</span>
                    <span class="custom-option" data-value="monochrome" style="background: linear-gradient(to right, #2C2C2C, #C0C0C0, #FFFFFF);">Monochrome</span>
                    <span class="custom-option" data-value="horizon" style="background: linear-gradient(to right, #708090, #4682B4, #FFFFF0);">Horizon</span>
                </div>
            </div>
            <input type="hidden" id="colorThemeSelect">  
        </div>
        <p style="font-size: 0.9rem; opacity: 0.7; margin-top: 0.5rem; font-style: italic;">* Reload to apply</p>
      </div>
    </form>
  `,
  appearance_zh: `
    <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem;">å¤–è§‚è®¾ç½®</h2>
    <form id="appearance-form">
      <div style="margin-bottom: 1.5rem;">
        <label style="display: flex; align-items: center; gap: 0.75rem; font-size: 1.1rem;">
          <input type="checkbox" id="darkModeToggle" />
          <span>å¯ç”¨æ·±è‰²æ¨¡å¼</span>
        </label>
      </div>
      <div style="margin-bottom: 1.5rem;">
          <label style="font-size: 1.1rem;">è¯­è¨€:
            <select id="languageSelect" class="preferences-select">
              <option value="english">English</option>
              <option value="chinese">ä¸­æ–‡</option>
            </select>
          </label>
      </div>
      <div style="margin-bottom: 1.5rem;">
        <label style="font-size: 1.1rem;">æ¨èä¸»é¢˜é¢œè‰²:</label>
        <div class="custom-select-wrapper">
            <div class="custom-select" id="customThemeSelectSuggested">
                <div class="custom-select-trigger">
                    <span>Select Theme</span>
                    <div class="arrow">â–¼</div>
                </div>
                <div class="custom-options">
                    <span class="custom-option" data-value="blue-green" style="background: linear-gradient(135deg, #3b82f6 0%, #10b981 50%, #8b5cf6 100%);">æå…‰ (é»˜è®¤)</span>
                    <span class="custom-option" data-value="sunset" style="background: linear-gradient(to right, #FF7E5F, #00C9A7, #1A2A6C);">æ—¥è½</span>
                    <span class="custom-option" data-value="coral" style="background: linear-gradient(to right, #FF6F61, #40E0D0, #4B0082);">çŠç‘šç¤</span>
                    <span class="custom-option" data-value="autumn" style="background: linear-gradient(to right, #CC5500, #DAA520, #8B4513);">ç§‹å¤©</span>
                    <span class="custom-option" data-value="sunrise" style="background: linear-gradient(to right, #FFDAB9, #FF7F50, #FFFACD);">æ—¥å‡º</span>
                    <span class="custom-option" data-value="lavender" style="background: linear-gradient(to right, #C8A2C8, #9DC183, #FFFDD0);">è–°è¡£è‰</span>
                    <span class="custom-option" data-value="cyber" style="background: linear-gradient(to right, #000000, #00FFFF);">èµ›åš</span>
                </div>
            </div>
        </div>
      </div>
      <div style="margin-bottom: 1.5rem;">
        <label style="font-size: 1.1rem;">å…¶ä»–ä¸»é¢˜é¢œè‰²:</label>
        <div class="custom-select-wrapper">
            <div class="custom-select" id="customThemeSelectOther">
                <div class="custom-select-trigger">
                    <span>Select Theme</span>
                    <div class="arrow">â–¼</div>
                </div>
                <div class="custom-options">
                    <span class="custom-option" data-value="aurora-veil" style="background: linear-gradient(to right, #32CD32, #00FFFF, #8A2BE2);">æå…‰é¢çº±</span>
                    <span class="custom-option" data-value="twilight" style="background: linear-gradient(to right, #50C878, #0F52BA, #FF00FF);">æš®å…‰</span>
                    <span class="custom-option" data-value="forest" style="background: linear-gradient(to right, #228B22, #87CEEB, #E6E6FA);">è¿·é›¾æ£®æ—</span>
                    <span class="custom-option" data-value="ocean-mist" style="background: linear-gradient(to right, #001F3F, #3D9970, #E0FFFF);">æµ·æ´‹è¿·é›¾</span>
                    <span class="custom-option" data-value="solar" style="background: linear-gradient(to right, #FFD700, #DC143C, #2E0854);">å¤ªé˜³èƒ½</span>
                    <span class="custom-option" data-value="crimson" style="background: linear-gradient(to right, #FFC0CB, #C21E56, #420D09);">ç»¯çº¢</span>
                    <span class="custom-option" data-value="monochrome" style="background: linear-gradient(to right, #2C2C2C, #C0C0C0, #FFFFFF);">å•è‰²</span>
                    <span class="custom-option" data-value="horizon" style="background: linear-gradient(to right, #708090, #4682B4, #FFFFF0);">åœ°å¹³çº¿</span>
                </div>
            </div>
            <input type="hidden" id="colorThemeSelect"> 
        </div>
        <p style="font-size: 0.9rem; opacity: 0.7; margin-top: 0.5rem; font-style: italic;">* åˆ·æ–°é¡µé¢ä»¥åº”ç”¨</p>
      </div>
    </form>
  `,
  account_en: `
    <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem;">Account Settings</h2>
    <form id="account-form">
      <div style="margin-bottom: 1.5rem;">
        <label style="font-size: 1.1rem;">Email:
          <input type="email" id="accountEmail" class="preferences-input" placeholder="user@example.com" />
        </label>
      </div>
      <div style="margin-bottom: 1.5rem;">
        <label style="font-size: 1.1rem;">Password:
          <input type="password" id="accountPassword" class="preferences-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </label>
      </div>
    </form>
  `,
  account_zh: `
    <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem;">è´¦æˆ·è®¾ç½®</h2>
    <form id="account-form">
      <div style="margin-bottom: 1.5rem;">
        <label style="font-size: 1.1rem;">é‚®ç®±:
          <input type="email" id="accountEmail" class="preferences-input" placeholder="user@example.com" />
        </label>
      </div>
      <div style="margin-bottom: 1.5rem;">
        <label style="font-size: 1.1rem;">å¯†ç :
          <input type="password" id="accountPassword" class="preferences-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </label>
      </div>
    </form>
  `,
  notifications_en: `
    <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem;">Notification Settings</h2>
    <form id="notifications-form">
      <div style="margin-bottom: 1.5rem;">
        <label style="display: flex; align-items: center; gap: 0.75rem; font-size: 1.1rem;">
          <input type="checkbox" id="emailNotifToggle" />
          <span>Email Notifications</span>
        </label>
      </div>
      <div style="margin-bottom: 1.5rem;">
        <label style="display: flex; align-items: center; gap: 0.75rem; font-size: 1.1rem;">
          <input type="checkbox" id="pushNotifToggle" />
          <span>Push Notifications</span>
        </label>
      </div>
    </form>
  `,
  notifications_zh: `
    <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem;">é€šçŸ¥è®¾ç½®</h2>
    <form id="notifications-form">
      <div style="margin-bottom: 1.5rem;">
        <label style="display: flex; align-items: center; gap: 0.75rem; font-size: 1.1rem;">
          <input type="checkbox" id="emailNotifToggle" />
          <span>é‚®ä»¶é€šçŸ¥</span>
        </label>
      </div>
      <div style="margin-bottom: 1.5rem;">
        <label style="display: flex; align-items: center; gap: 0.75rem; font-size: 1.1rem;">
          <input type="checkbox" id="pushNotifToggle" />
          <span>æ¨é€é€šçŸ¥</span>
        </label>
      </div>
    </form>
  `
};

function renderSettings(category) {
    updateSidebarLanguage();
    // Reapply dark mode after rendering panel
    const darkModeStored = (localStorage.getItem('arisEduDarkMode') === null ? true : localStorage.getItem('arisEduDarkMode') === 'true');
    setTimeout(() => applyDarkMode(darkModeStored), 0);
  // Language switching
  const lang = localStorage.getItem('arisEduLanguage') || 'english';
  let key = category;
  if (category === 'appearance') key = lang === 'chinese' ? 'appearance_zh' : 'appearance_en';
  if (category === 'account') key = lang === 'chinese' ? 'account_zh' : 'account_en';
  if (category === 'notifications') key = lang === 'chinese' ? 'notifications_zh' : 'notifications_en';
  document.getElementById('settings-panel').innerHTML = settingsOptions[key] || '';
  // Add form logic for each category
  if (category === 'appearance') {
    const darkModeToggle = document.getElementById('darkModeToggle');
    const languageSelect = document.getElementById('languageSelect');
    const colorThemeSelect = document.getElementById('colorThemeSelect');
    // Ensure language dropdown is always visible
    if (languageSelect) languageSelect.style.display = '';
    // Set initial values from localStorage
    if (darkModeToggle) darkModeToggle.checked = (localStorage.getItem('arisEduDarkMode') === null ? true : localStorage.getItem('arisEduDarkMode') === 'true');
    if (languageSelect) languageSelect.value = localStorage.getItem('arisEduLanguage') || 'english';
    
    // Custom Select Logic
    if (colorThemeSelect) {
        const savedTheme = localStorage.getItem('arisEduColorTheme') || 'blue-green';
        colorThemeSelect.value = savedTheme;
        
        const refreshAllDropdowns = (currentValue) => {
            ['customThemeSelectSuggested', 'customThemeSelectOther'].forEach(id => {
                const wrapper = document.getElementById(id);
                if(!wrapper) return;
                
                wrapper.classList.remove('open'); // Close all on selection
                
                const triggerSpan = wrapper.querySelector('.custom-select-trigger span');
                const options = wrapper.querySelectorAll('.custom-option');
                const matching = Array.from(options).find(o => o.dataset.value === currentValue);
                
                if(matching) {
                    triggerSpan.textContent = matching.textContent.trim();
                    
                    // Copy the exact style attribute (gradient) from the option
                    const gradientStyle = matching.getAttribute('style');
                    if(gradientStyle) {
                        triggerSpan.setAttribute('style', gradientStyle);
                    }
                    
                    triggerSpan.classList.add('gradient-text-selected');
                } else {
                    const isChinese = localStorage.getItem('arisEduLanguage') === 'chinese';
                    triggerSpan.textContent = isChinese ? "é€‰æ‹©ä¸»é¢˜" : "Select Theme";
                    triggerSpan.style.background = '';
                    triggerSpan.classList.remove('gradient-text-selected');
                }
            });
        };

        // Helper to setup a dropdown
        const setupDropdown = (wrapperId) => {
            const wrapper = document.getElementById(wrapperId);
            if (!wrapper) return;
            
            const trigger = wrapper.querySelector('.custom-select-trigger');
            const options = wrapper.querySelectorAll('.custom-option');
            
            // Toggle
            trigger.addEventListener('click', function(e) {
                // Close others
                 document.querySelectorAll('.custom-select').forEach(w => {
                     if(w !== wrapper) w.classList.remove('open');
                 });
                wrapper.classList.toggle('open');
                e.stopPropagation();
            });

            // Selection
            options.forEach(option => {
                option.addEventListener('click', function() {
                     const value = this.dataset.value;
                     colorThemeSelect.value = value;
                     
                     // Update LocalStorage & App
                     localStorage.setItem('arisEduColorTheme', value);
                     const darkModeStored = (localStorage.getItem('arisEduDarkMode') === null ? true : localStorage.getItem('arisEduDarkMode') === 'true');
                     applyDarkMode(darkModeStored);
                     if (window.applyGlobalTheme) window.applyGlobalTheme();

                     // Update ALL dropdowns
                     refreshAllDropdowns(value);
                });
            });
        };

        // Initialize both
        setupDropdown('customThemeSelectSuggested');
        setupDropdown('customThemeSelectOther');
        
        // Initial Refresh
        refreshAllDropdowns(savedTheme);

        // Close on outside click (Shared)
        document.addEventListener('click', function(e) {
            ['customThemeSelectSuggested', 'customThemeSelectOther'].forEach(id => {
                 const wrapper = document.getElementById(id);
                 if (wrapper && !wrapper.contains(e.target)) {
                    wrapper.classList.remove('open');
                 }
            });
        });
    }

    // Save settings automatically
    if (darkModeToggle) darkModeToggle.addEventListener('change', function() {
      localStorage.setItem('arisEduDarkMode', darkModeToggle.checked);
      applyDarkMode(darkModeToggle.checked);
    });
    if (languageSelect) languageSelect.addEventListener('change', function() {
      const prevLang = localStorage.getItem('arisEduLanguage') || 'english';
      localStorage.setItem('arisEduLanguage', languageSelect.value);
      renderSettings(category);
      const darkModeStored = (localStorage.getItem('arisEduDarkMode') === null ? true : localStorage.getItem('arisEduDarkMode') === 'true');
      applyDarkMode(darkModeStored);
      // Show BETA disclaimer if switching to Chinese
      if (prevLang === 'english' && languageSelect.value === 'chinese') {
        const disclaimer = document.createElement('div');
        disclaimer.textContent = 'ä¸­æ–‡æ¨¡å¼ (BETA): éƒ¨åˆ†å†…å®¹å¯èƒ½å°šæœªå®Œå…¨ç¿»è¯‘æˆ–ä¼˜åŒ–ã€‚';
        disclaimer.style.position = 'fixed';
        disclaimer.style.bottom = '32px';
        disclaimer.style.right = '32px';
        disclaimer.style.background = '#fbbf24';
        disclaimer.style.color = '#222';
        disclaimer.style.padding = '1rem 2rem';
        disclaimer.style.borderRadius = '1rem';
        disclaimer.style.fontWeight = 'bold';
        disclaimer.style.boxShadow = '0 4px 16px rgba(0,0,0,0.12)';
        disclaimer.style.zIndex = '9999';
        document.body.appendChild(disclaimer);
        setTimeout(() => {
          disclaimer.remove();
        }, 5000);
      }
    });

  }
  if (category === 'account') {
    const accountEmail = document.getElementById('accountEmail');
    const accountPassword = document.getElementById('accountPassword');
    if (accountEmail) accountEmail.value = localStorage.getItem('arisEduAccountEmail') || '';
    if (accountPassword) accountPassword.value = localStorage.getItem('arisEduAccountPassword') || '';
    if (accountEmail) accountEmail.addEventListener('input', function() {
      localStorage.setItem('arisEduAccountEmail', accountEmail.value);
      updateTaskbarUsername();
    });
    if (accountPassword) accountPassword.addEventListener('input', function() {
      localStorage.setItem('arisEduAccountPassword', accountPassword.value);
    });
  }
  // Always update taskbar username after rendering
  updateTaskbarUsername();
  if (category === 'notifications') {
    const emailNotifToggle = document.getElementById('emailNotifToggle');
    const pushNotifToggle = document.getElementById('pushNotifToggle');
    if (emailNotifToggle) emailNotifToggle.checked = localStorage.getItem('arisEduEmailNotif') === 'true';
    if (pushNotifToggle) pushNotifToggle.checked = localStorage.getItem('arisEduPushNotif') === 'true';
    if (emailNotifToggle) emailNotifToggle.addEventListener('change', function() {
      localStorage.setItem('arisEduEmailNotif', emailNotifToggle.checked);
    });
    if (pushNotifToggle) pushNotifToggle.addEventListener('change', function() {
      localStorage.setItem('arisEduPushNotif', pushNotifToggle.checked);
    });
  }
}

document.querySelectorAll('.settings-category').forEach(btn => {
  btn.addEventListener('click', function() {
    renderSettings(this.dataset.category);
    // Remove inline styles messing with theme manager
    document.querySelectorAll('.settings-category').forEach(b => {
        b.classList.remove('active');
        b.style.removeProperty('background'); // Let CSS/Theme Manager handle it
    });
    this.classList.add('active');
    
    // Reapply dark mode if enabled
    const darkModeStored = (localStorage.getItem('arisEduDarkMode') === null ? true : localStorage.getItem('arisEduDarkMode') === 'true');
    applyDarkMode(darkModeStored);
    updateTaskbarUsername();
  });
});

function applyDarkMode(darkMode) {
  // Delegate global theme application to theme_manager.js
  if(window.applyArisTheme) {
      window.applyArisTheme();
  }

  // Local UI Specifics (Inputs)
  const accountEmail = document.getElementById('accountEmail');
  const accountPassword = document.getElementById('accountPassword');
  if (accountEmail) {
    accountEmail.style.background = darkMode ? '#273244' : '#fff';
    accountEmail.style.color = darkMode ? '#e2e8f0' : '#0f172a';
    accountEmail.style.border = darkMode ? '1px solid #334155' : '';
  }
  if (accountPassword) {
    accountPassword.style.background = darkMode ? '#273244' : '#fff';
    accountPassword.style.color = darkMode ? '#e2e8f0' : '#0f172a';
    accountPassword.style.border = darkMode ? '1px solid #334155' : '';
  }
  
  // Update styles for dynamically rendered elements that might not be caught by generic theme manager
  updateTaskbarUsername();
}

// NOTE: manageAuroraBackground and gradients are now handled by theme_manager.js

// On load, apply dark mode if stored
function initialRender() {
  const darkModeStored = (localStorage.getItem('arisEduDarkMode') === null ? true : localStorage.getItem('arisEduDarkMode') === 'true');
  const category = 'appearance'; // Default category
  renderSettings(category);
  
  // Highlight the selected category
  setTimeout(() => {
    const selectedBtn = document.querySelector(`.settings-category[data-category="${category}"]`);
    if (selectedBtn) {
         selectedBtn.classList.add('active');
         // We trigger theme update to apply styles to the new active class
         applyDarkMode(darkModeStored);
    }
  }, 0);
}
initialRender();

function updateTaskbarUsername() {
  let username = localStorage.getItem('arisEduAccountEmail') || '';
  // Check for user JSON object
  const userJson = localStorage.getItem('user');
  if (userJson) {
    try {
      const userObj = JSON.parse(userJson);
      if (userObj && (userObj.name || userObj.email)) {
        username = userObj.name || userObj.email;
      }
    } catch (e) {}
  }
  const loginBtn = document.getElementById('login-signup-button');
  if (loginBtn) {
    if (username) {
      loginBtn.textContent = `ğŸ‘¤ ${username}`;
      loginBtn.href = '#';
    } else {
      loginBtn.textContent = 'ğŸ” Login/Signup';
      loginBtn.href="LoginSignup.html";
    }
  }
}

// Listen for dark mode toggle
document.addEventListener('change', function(e) {
  if (e.target && e.target.id === 'darkModeToggle') {
    const darkMode = e.target.checked;
    localStorage.setItem('arisEduDarkMode', darkMode);
    applyDarkMode(darkMode);
  }
});
</script>

<script>
    // Settings Menu Toggle
    document.addEventListener('DOMContentLoaded', () => {
        const settingsButton = document.getElementById('settings-button');
        const menu = document.getElementById('settings-menu');
        if (settingsButton && menu) {
            settingsButton.addEventListener('click', (e) => {
                const isHidden = menu.getAttribute('aria-hidden') === 'true';
                menu.setAttribute('aria-hidden', String(!isHidden));
                if (isHidden) {
                    menu.style.visibility = 'visible';
                    menu.style.opacity = '1';
                    menu.style.transform = 'translateY(0)';
                } else {
                    menu.style.visibility = 'hidden';
                    menu.style.opacity = '0';
                    menu.style.transform = 'translateY(-6px)';
                }
                e.stopPropagation();
            });

            // Close when clicking outside
            document.addEventListener('click', (e) => {
                if (!menu.contains(e.target) && e.target !== settingsButton) {
                    menu.setAttribute('aria-hidden', 'true');
                    menu.style.visibility = 'hidden';
                    menu.style.opacity = '0';
                    menu.style.transform = 'translateY(-6px)';
                }
            });
        }
        
        // Blank Page / View Background Logic
        const viewBgBtn = document.getElementById('view-bg-button');
        const mainContainer = document.querySelector('.preferences-layout');
        
        if (viewBgBtn && mainContainer) {
            viewBgBtn.addEventListener('click', () => {
                const isHidden = mainContainer.style.display === 'none';
                if (isHidden) {
                    // Show Settings
                    mainContainer.style.display = 'flex';
                    viewBgBtn.textContent = 'ğŸ‘ï¸ View BG';
                } else {
                    // Hide Settings (Show only BG)
                    mainContainer.style.display = 'none';
                    viewBgBtn.textContent = 'ğŸ”™ Settings';
                }
            });
        }
    });
</script>

    <!-- ArisEdu Global Search -->

    <script src="/global_translations.js"></script>
    <script src="../search_data.js"></script>
    <script src="../search_logic.js"></script>
</body>
</html>
